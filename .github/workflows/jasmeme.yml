name: Builder-jasmeme

on:
  workflow_dispatch:
    inputs:
      DEVICE_NAME:
        description: 'Dispositivo'
        required: true
        default: 'wayne'
      ROM_URL:
        description: 'Rom Miui Lavender'
        required: true
        default: 'https://bigota.d.miui.com/V12.5.3.0.QFGMIXM/miui_LAVENDERGlobal_V12.5.3.0.QFGMIXM_0baf420181_10.0.zip'
      TOKEN_GITHUB:
        description: 'Github Token'
        required: true
        default: 'Ponga su token'


jobs:
  build:
    if: github.event.repository.owner.id == github.event.sender.id
    runs-on: ubuntu-18.04
    
    steps:
    - name: Checkeando 
      uses: actions/checkout@main
      
    - name: Limpiando y Actualizando
      run: |
        sudo apt -y purge azure-cli ghc* zulu* hhvm llvm* firefox google* dotnet* powershell openjdk* mysql* php*
        sudo apt update -y
        sudo apt upgrade -y 
         
    - name: Clonando Repositorio
      run: |
        mkdir miui
        cd miui
        git clone https://github.com/FabricioSC123/builder-jasmeme.git -b ${{ github.event.inputs.DEVICE_NAME }} jasmeme
        
    - name: Instalando Packages
      run: |
        cd miui/jasmeme
        sudo ./prep.sh

    - name: Creando Port
      run: |
        cd miui/jasmeme
        wget -O rom.zip ${{ github.event.inputs.ROM_URL }}
        wget -O stock.tgz https://bigota.d.miui.com/V11.0.28.0.QDIMIXM/jasmine_global_images_V11.0.28.0.QDIMIXM_20210702.0000.00_10.0_d88fa668a6.tgz
        ./port.sh rom.zip stock.tgz

    - name: Subiendo Port
      uses: softprops/action-gh-release@v1
      with:
        files: miui/jasmeme/out/10_MIUI_12_wayne_*.zip
        name: 10_MIUI_12_${{ github.event.inputs.DEVICE_NAME }}
        tag_name: wayne-(date +%d/%m/%Y-%H:%M)
        body: Rom Port from ${{ github.event.inputs.DEVICE_NAME }} by FabricioSC
      env:
        GITHUB_TOKEN: ${{ github.event.inputs.TOKEN_GITHUB }}
